/*! site 2013-12-23 */

var gb=gb||{};gb.Namespace=function(ns,ns_string){var pl,i,parts=ns_string.split("."),parent=ns;for("gb"==parts[0]&&(parts=parts.slice(1)),pl=parts.length,i=0;pl>i;i++)"undefined"==typeof parent[parts[i]]&&(parent[parts[i]]={}),parent=parent[parts[i]];return parent},gb.Class=function(parent){var klass=function(){this.init.apply(this,arguments)};if(parent){var subclass=function(){};subclass.prototype=parent.prototype,klass.prototype=new subclass}return klass.prototype.init=function(){},klass.fn=klass.prototype,klass.fn.parent=klass,klass.extend=function(obj){var extended=obj.extended;for(var i in obj)klass[i]=obj[i];extended&&extended(klass)},klass.include=function(obj){var included=obj.included;for(var i in obj)klass.fn[i]=obj[i];included&&included(klass)},klass},gb.Namespace(gb,"gb.util"),gb.util.RandomArray=function(size,scale){for(var r=new Array(size),i=0;size>i;i++)r[i]=Math.floor(Math.random()*(scale+1));return r},gb.util.ArrayMax=function(array){return Math.max.apply(Math,array)},gb.util.ArrayMin=function(array){return Math.min.apply(Math,array)},gb.util.ZeroFill=function(number,width){return width-=number.toString().length,width>0?new Array(width+(/\./.test(number)?2:1)).join("0")+number:number+""},gb.util.throttle=function(callback,timeoutMS){var timeoutID,timeout=timeoutMS||500;return function(){var scope=this,args=arguments;clearTimeout(timeoutID),timeoutID=setTimeout(function(){callback.apply(scope,Array.prototype.slice.call(args))},timeout)}},gb.Namespace(gb,"gb.ui"),gb.ui.ScreenSizes={sm:480,md:768,lg:992,xl:1200},gb.ui.screenMode="lg",gb.ui.onResizeHandler=function(){var breaks=gb.ui.ScreenSizes,width=$(window).width();gb.ui.screenWidth=$(window).width(),gb.ui.screenHeight=$(window).height(),width<breaks.sm?gb.ui.screenMode="xs":width>=breaks.sm&&width<breaks.md?gb.ui.screenMode="sm":width>=breaks.md&&width<breaks.lg?gb.ui.screenMode="md":width>=breaks.lg&&width<breaks.xl?gb.ui.screenMode="lg":width>=breaks.xl&&(gb.ui.screenMode="xl"),$(this).trigger("resizeEnd")},gb.Namespace(gb,"gb.ui.PreloadableImage"),gb.ui.PreloadableImage=new gb.Class,gb.ui.PreloadableImage=function(id,source,onSuccess,onError){"use strict";this.id=id,this.startTime=(new Date).valueOf(),this.endTime=this.startTime,this.image=new Image,this.SetSource(source),this.SetOnLoad(onSuccess),this.SetOnError(onError)},gb.ui.PreloadableImage.prototype.SetSource=function(source){return source?(this.image.src=source,void 0):(this.image.src="",void 0)},gb.ui.PreloadableImage.prototype.SetOnLoad=function(onSuccess){var that=this;if(!onSuccess||"function"!=typeof onSuccess)return this.image.onload=function(){that.endTime=(new Date).valueOf()},void 0;var onSuccessWrapper=function(e){that.endTime=(new Date).valueOf(),onSuccess(e)};this.image.onload=onSuccessWrapper},gb.ui.PreloadableImage.prototype.SetOnError=function(onError){var that=this;return onError&&"function"==typeof onError?(this.endTime=(new Date).valueOf(),this.image.onerror=onError,void 0):(this.image.onerror=function(){that.endTime=(new Date).valueOf()},void 0)},gb.ui.PreloadableImage.prototype.GetTotalTimeMS=function(){return this.endTime-this.startTime},gb.Namespace(gb,"gb.ui.Tile"),gb.ui.Tile=new gb.Class,gb.ui.Tile.include({init:function(parent,elementAttributes){"use strict";this.jq=$("<div/>",elementAttributes).appendTo(parent)},transition:function(attr){this.jq.transition(attr)},show:function(){this.jq.show()},hide:function(){this.jq.hide()},onResizeEndHandler:function(){console.log("Tile.onResizeEndHandler")},activate:function(){},deactivate:function(){}}),gb.Namespace(gb,"gb.util.TimeOutCycle"),gb.util.TimeOutCycle=new gb.Class,gb.util.TimeOutCycle=function(timeoutMS,callback){"use strict";this.timeoutMS=timeoutMS,this.isRunning=!1,this.timeoutHandle=null,this.tickHandler=function(){console.log("default tickHandler")},this.setTimeoutMS(timeoutMS),this.setTickHandler(callback)},gb.util.TimeOutCycle.prototype.setTickHandler=function(callback){callback&&"function"==typeof callback&&(this.tickHandler=callback)},gb.util.TimeOutCycle.prototype.setTimeoutMS=function(timeoutMS){timeoutMS&&(this.timeoutMS=timeoutMS)},gb.util.TimeOutCycle.prototype.start=function(){this.isRunning=!0,this._tick()},gb.util.TimeOutCycle.prototype.stop=function(){this.isRunning=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)},gb.util.TimeOutCycle.prototype._tick=function(){this.isRunning&&(this.tickHandler(),this._setNext())},gb.util.TimeOutCycle.prototype._setNext=function(){var that=this;this.isRunning&&(this.timeoutHandle=setTimeout(function(){that._tick()},this.timeoutMS))},function($){$.fn.fullscreen=function(options){var settings=$.extend({front:"#background",bgHeightClass:"bgheight",bgWidthClass:"bgwidth",refreshInterval:5e3,fadeOutTime:500,fadeInTime:700,successCallback:function(){},errorCallback:function(){},images:["images/image-001.png","images/image-002.png","images/image-003.png"]},options),theWindow=$(window),bkgImage=$(settings.front),windowAspect=theWindow.width()/theWindow.height(),imageAspect=bkgImage.width()/bkgImage.height(),intervalHandler=null,backgrounds=[],index=0,refreshImage=function(){index<settings.images.length-1?index++:index=0;var onComplete=function(){bkgImage.attr("src",settings.images[index]),bkgImage.transition({opacity:1},settings.fadeInTime,"snap"),resizeBackgound()};bkgImage.transition({opacity:0},settings.fadeOutTime,"snap",onComplete)},resizeBackgound=function(){var width=backgrounds[index].image.width,height=backgrounds[index].image.height;imageAspect=width/height,windowAspect=theWindow.width()/theWindow.height(),windowAspect>imageAspect?bkgImage.removeClass().addClass(settings.bgWidthClass):bkgImage.removeClass().addClass(settings.bgHeightClass)},preloadBackgrounds=function(){for(var i=0,n=settings.images.length;n>i;i++){var id="img"+i,source=settings.images[i],pre=new gb.ui.PreloadableImage(id,source,settings.successCallback,settings.errorCallback);backgrounds.push(pre)}},setRefreshInterval=function(){theWindow.on("resizeEnd",resizeBackgound),intervalHandler||(intervalHandler=setInterval(refreshImage,settings.refreshInterval))};return preloadBackgrounds(),setRefreshInterval(),this}}(jQuery),function($){$.fn.search=function(options){var that=this,intervalHandler=null,previousTerm=null,settings=$.extend({input:"search-field",results:"search-results",minchars:4,requestInterval:3e3},options),showHeading=function(collectionName,count){var heading="<div class='heading'>"+collectionName+": "+count+"</div>";that.resultsDiv.append(heading)},showTracks=function(collectionName,data){var tracks=data.tracks;if(data.count&&tracks&&tracks.length){showHeading(collectionName,data.count);for(var i=0,n=tracks.length;n>i;i++){var track="<div class='track'><div class='title'>"+tracks[i].Name+"</div><div class='normal'>"+tracks[i].Artist+"</div><div class='normal'>"+tracks[i].Album+"</div></div>";that.resultsDiv.append(track)}}},showTitle=function(collectionName,data){var tracks=data.tracks;if(data.count&&tracks&&tracks.length){showHeading(collectionName,data.count);for(var i=0,n=tracks.length;n>i;i++){var track="<div class='track'><div class='title'>"+tracks[i]._id+" <span class='count'>"+tracks[i].value+"</span></div></div>";that.resultsDiv.append(track)}}},hideResults=function(){that.resultsDiv.empty(),that.resultsDiv.hide()},showResults=function(response){that.resultsDiv.show();var keys=response.keys;if(that.resultsDiv.empty(),response.total){var found="<div class='found'>Found: "+response.total+"</div>";that.resultsDiv.append(found);for(var i=0,n=keys.length;n>i;i++){var collectionName=keys[i],data=response.data[collectionName];"find"===response.data[collectionName].type?showTracks(collectionName,data):showTitle(collectionName,data)}}else that.resultsDiv.append("<div class='none-found'>No results found.</div>")},requestQuery=function(){var term=that.searchInput.val().trim();if(term.length<settings.minchars)return hideResults(),void 0;if(term!==previousTerm){previousTerm=term;var url="/multi-search/"+term;$.ajax({url:url,type:"GET",dataType:"json",success:function(response,status){console.log("success:",status),showResults(response)}})}};this.onResize=function(){if(that.searchInput){var pos=that.searchInput.position(),width=that.searchInput.outerWidth(!0),height=that.searchInput.outerHeight(!0);that.resultsDiv.css({position:"absolute",top:pos.top+height+10+"px",left:pos.left+"px",width:width+"px",height:"600px"})}};var init=function(){return that.searchInput=$("#"+settings.input),"undefined"==typeof that.searchInput[0]?null:(intervalHandler||(intervalHandler=setInterval(requestQuery,settings.requestInterval)),that.searchInput.after("<div id='"+settings.results+"'></div>"),that.resultsDiv=$("#"+settings.results),that.onResize(),that.resultsDiv.hide(),that)};return init()}}(jQuery),$(function(){var $search=$("#search-field").search();$search&&$(window).resize(gb.util.throttle($search.onResize,500))}),$(function(){var month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Timeline=function(onDataHandler){this.x=0,this.y=0,this.margin=40,this.trackHeight=24,this.yTrack=160,this.paper=null,this.selected=null,this.startDateLabel=null,this.endDateLabel=null,this.htmlContent=null,this.id="timeline",this.jqContainer=$("#"+this.id),this.ajaxURL="/api/timeline",this.timelineData=null,onDataHandler&&"function"==typeof onDataHandler&&(this.onDataHandler=onDataHandler);var that=this;$.getJSON(this.ajaxURL,function(data){that.timelineData=data,onDataHandler()})};Timeline.prototype.Resize=function(){this.htmlContent||(this.htmlContent=this.jqContainer.html()),this.width=this.jqContainer.width(),this.height=this.jqContainer.height(),this.trackWidth=this.width-2*this.margin,this.paper&&this.paper.clear(),this.width>768?(this.jqContainer.empty(),this.paper=Raphael(this.id,this.width,this.height),this.ProcessData(this.timelineData),this.Draw()):this.jqContainer.html(this.htmlContent)},Timeline.prototype.ProcessData=function(rawData){this.dataPoints=[];for(var min=null,max=null,len=rawData.length,entry=null,i=0,n=len;n>i;i++)entry=rawData[i],entry.startDate&&(min=min?Math.min(entry.startDate,min):entry.startDate,max=max?Math.max(entry.startDate,max):entry.startDate),entry.endDate||(entry.endDate=(new Date).valueOf()),min=min?Math.min(entry.endDate,min):entry.endDate,max=max?Math.max(entry.endDate,max):entry.endDate;var xRange=max-min;for(this.xMin=min,this.xMax=max,this.xScale=this.trackWidth/xRange,i=0,n=len;n>i;i++)entry=rawData[i],entry.xStart=Math.floor(this.margin+this.xScale*(entry.startDate-min)),entry.xEnd=Math.floor(this.margin+this.xScale*(entry.endDate-min)),this.dataPoints.push(entry)},Timeline.prototype.Draw=function(){var that=this,line="M"+(this.x+this.margin)+" "+this.yTrack+"L"+(this.width-this.margin)+" "+this.yTrack;this.track=this.paper.path(line);var strokeStyle={stroke:"#ccc","stroke-width":this.trackHeight,"stroke-linecap":"round"};this.track.attr(strokeStyle);for(var onHover=function(){var sp=this.data("startPoint"),ep=this.data("endPoint"),dataPoint=this.data("dataPoint");if(that.selected=that.DrawSegment(dataPoint.startDate,dataPoint.endDate),that.selected.animate({opacity:1},500,"easeInOut"),sp.stop(),sp.toFront(),ep.stop(),ep.toFront(),sp.animate({fill:"#DE001E"},50,"linear"),ep.animate({cx:dataPoint.xEnd,fill:"#FF8400"},300,"easeInOut"),that.DrawHeader(dataPoint),that.startDateLabel&&that.startDateLabel.remove(),that.endDateLabel&&that.endDateLabel.remove(),this.toFront(),that.startDateLabel=that.DrawDate(dataPoint.startDate),that.endDateLabel=that.DrawDate(dataPoint.endDate),that.startDateLabel.animate({opacity:1},300,"easeInOut"),dataPoint.startDate!=dataPoint.endDate){var x1=that.startDateLabel.getBBox().x2,x2=that.endDateLabel.getBBox().x;x1>x2&&that.endDateLabel.transform("T20,0"),that.endDateLabel.animate({opacity:1},300,"easeInOut")}},onHoverOut=function(){var sp=this.data("startPoint"),ep=this.data("endPoint"),dataPoint=this.data("dataPoint");that.selected&&that.selected.remove(),that.startDateLabel&&that.startDateLabel.remove(),that.endDateLabel&&that.endDateLabel.remove(),sp.animate({fill:"#333"},50,"linear"),ep.animate({cx:dataPoint.xStart,fill:"#999"},500,"easeInOut")},onClick=function(){this.data("dataPoint")},styles={hoverPoint:{fill:"#00b","stroke-width":"0",opacity:0},startPoint:{opacity:0,cx:0,fill:"#ccc","stroke-width":"0"},endPoint:{fill:"#999","stroke-width":"0"}},i=0,n=this.dataPoints.length;n>i;i++){var entry=this.dataPoints[i],hoverPoint=this.paper.circle(entry.xStart,this.yTrack,15);hoverPoint.attr(styles.hoverPoint);var startPoint=this.paper.circle(entry.xStart,this.yTrack,10);startPoint.attr(styles.startPoint),startPoint.animate({opacity:1,fill:"#333",cx:entry.xStart},100*i,"easeInOut");var endPoint=this.paper.circle(entry.xStart,this.yTrack,5);endPoint.attr(styles.endPoint),hoverPoint.toFront(),hoverPoint.data("dataPoint",entry),hoverPoint.data("startPoint",startPoint),hoverPoint.data("endPoint",endPoint),hoverPoint.hoverInBounds(onHover,onHoverOut),hoverPoint.click(onClick)}var last=this.dataPoints.length-1;this.DrawHeader(this.dataPoints[last]),this.DrawTicks()},Timeline.prototype.DrawHeader=function(dataPoint){var headerStyle={"font-size":"32pt","text-anchor":"start","font-family":"Source Sans Pro"},subheadStyle={"font-size":"16pt","text-anchor":"start","font-family":"Source Sans Pro"},subhead2Style={"font-size":"16pt","text-anchor":"start","font-family":"Source Sans Pro"};this.title&&this.title.remove(),this.title=this.paper.text(this.margin,40,dataPoint.title),this.title.attr(headerStyle),this.subhead&&this.subhead.remove(),this.subhead=this.paper.text(this.margin,70,dataPoint.employer),this.subhead.attr(subheadStyle),this.location&&this.location.remove(),this.location=this.paper.text(this.margin,94,dataPoint.location),this.location.attr(subhead2Style)},Timeline.prototype.DrawTicks=function(){for(var dateStyle={fill:"#333","font-size":"10pt","font-family":"Source Sans Pro"},startDate=new Date(this.dataPoints[0].startDate),startYear=startDate.getUTCFullYear(),endDate=new Date(this.dataPoints[this.dataPoints.length-1].endDate),endYear=endDate.getUTCFullYear(),i=startYear+1;endYear>=i;i++){var xPos=new Date("Jan 1, "+i).valueOf(),dateXPos=Math.floor(this.margin+(xPos-this.xMin)*this.xScale);this.paper.text(dateXPos,this.yTrack+30,i).attr(dateStyle)}},Timeline.prototype.DrawDate=function(timestamp){var monthStyle={opacity:0,fill:"#333","font-size":"16pt","font-family":"Source Sans Pro"},yearStyle={opacity:0,fill:"#333","font-size":"12pt","font-family":"Source Sans Pro"},dateXPos=Math.floor(this.margin+(timestamp-this.xMin)*this.xScale),date=new Date(timestamp),monthStr=month[date.getUTCMonth()],year=date.getUTCFullYear(),marker=this.paper.set();return marker.push(this.paper.text(dateXPos,this.yTrack-40,monthStr).attr(monthStyle),this.paper.text(dateXPos,this.yTrack-20,year).attr(yearStyle)),marker},Timeline.prototype.DrawSegment=function(start,end){var startX=Math.floor(this.margin+(start-this.xMin)*this.xScale),endX=Math.floor(this.margin+(end-this.xMin)*this.xScale),line="M"+startX+" "+this.yTrack+"L"+endX+" "+this.yTrack;this.selected&&this.selected.remove(),line=this.paper.path(line);var strokeStyle={opacity:.7,stroke:"#FAD905","stroke-width":this.trackHeight-4,"stroke-linecap":"round"};return line.attr(strokeStyle)};var onResizeHandler=function(){timeline.paper&&timeline.paper.clear(),timeline.Resize()},onData=function(){$(window).on("resizeEnd",onResizeHandler),$(window).on("resize",function(){timeline.paper&&timeline.paper.clear()}),onResizeHandler()},timeline=new Timeline(onData)}),gb.Namespace(gb,"gb.ui.FullScreen"),gb.ui.FullScreen=new gb.Class,gb.ui.FullScreen.include({init:function(){"use strict";this.spinner=$("#spinner"),this.spinner.show(),this.mediaHost="//media.suayan.com/",this.images=[],this.howMany=3,this.countLoaded=0,this.initImageList(),this.initBackground(),console.log("init: FullScreen.")},initBackground:function(){var that=this;$("body").fullscreen({refreshInterval:1e4,fadeOutTime:5e3,fadeInTime:3e3,successCallback:function(){that.checkSpinner()},errorCallback:function(){that.checkSpinner()},images:this.images})},checkSpinner:function(){this.countLoaded++,this.countLoaded==this.howMany&&this.spinner.hide()},initImageList:function(){this.images=[];for(var i=1;i<=this.howMany;i++){var numStr=gb.util.ZeroFill(i,3);this.images.push(this.mediaHost+"images/image-"+numStr+".jpg")}}}),gb.Namespace(gb,"gb.ui.Stage"),gb.ui.Stage=gb.Class(gb.ui.Tile),gb.ui.Stage.include({colors:["#FFFFFF","#D1DBBD","#91AA9D","#3E606F","#193441","#002A4A","#17607D","#FFF1CE","#FF9311","#E33200","#3C3658","#3EC8B7","#7CD0B4","#B9D8B1","#F7E0AE"],init:function(selector){"use strict";var that=this;this.tiles=[],this.tileOffsets=[],this.howMany=15,this.intervalMS=8e3,this.currentIndex=0,this.selector=selector,this.jq=$("#"+selector),this.contentSelector="#"+selector+"-content",this.content=$("<div id='"+selector+"-content'></div>"),this.jq.append(this.content),this.initTiles(),this.show(),this.timeoutCycle=new gb.util.TimeOutCycle(this.intervalMS,function(){that.rotate()}),this.timeoutCycle.start(),$(window).resize(function(){that.hide()}),$("#stage-next").on("click",function(){that.goToNext()}),$("#stage-prev").on("click",function(){that.goToPrevious()}),console.log("init: Stage.")},initTiles:function(){this.tiles=[],this.tileOffsets=[];for(var colorIndex=0,i=0;i<this.howMany;i++){var tile=new gb.ui.Tile(this.contentSelector,{id:"tile-"+i,"class":"tile"});tile.jq.html("<p>Tile: "+i+"</p>");var el=tile.jq.get(0);el.style.backgroundColor=this.colors[colorIndex],this.tiles.push(tile),colorIndex>this.colors.length-2?colorIndex=0:colorIndex++}this.resizeTiles()},resizeTiles:function(){for(var xPos=0,stageWidth=this.jq.width(),stageHeight=this.jq.height(),t=this.tiles,i=0,n=t.length;n>i;i++){t[i].jq.width(stageWidth),t[i].jq.height(stageHeight);var el=t[i].jq.get(0);el.style.top="0px",el.style.left=xPos+"px",this.tileOffsets[i]=xPos,xPos+=stageWidth}},rotate:function(){this.currentIndex<this.tiles.length-1?this.goToNext():this.goTo(0)},goToPrevious:function(){this.currentIndex>0?this.currentIndex--:this.currentIndex=0,this.goTo(this.currentIndex)},goToNext:function(){this.currentIndex<this.tiles.length-2?this.currentIndex++:this.currentIndex=this.tiles.length-1,this.goTo(this.currentIndex)},goTo:function(index){this.currentIndex=index;var xOffset=-1*this.tileOffsets[index];this.content.transition({x:xOffset},500,"snap")},show:function(){this.jq.hide(),this.goTo(this.currentIndex),this.jq.show()},onResizeEndHandler:function(){this.resizeTiles(),this.show()}}),gb.Namespace(gb,"gb.ui.ContentManager"),gb.ui.ContentManager=new gb.Class,gb.ui.ContentManager.include({init:function(selector){"use strict";this.content=$(selector),this.visible=!0,this.fullscreen=new gb.ui.FullScreen,this.stage=new gb.ui.Stage("stage");var that=this;$("#slideshow-button").click(function(){that.toggleSlideShow()}),$(window).on("resizeEnd",function(){that.onResizeEndHandler()}),console.log("init: ContentManager")},onResizeEndHandler:function(){this.stage.onResizeEndHandler()},toggleSlideShow:function(){this.visible=!this.visible,this.visible?this.show():this.hide()},show:function(){var that=this;this.content.stop().transition({opacity:1,duration:50},function(){that.content.attr({visibility:"visible",display:"block"})})},hide:function(){var that=this;this.content.stop().transition({opacity:0,duration:1e3},function(){that.content.attr({visibility:"hidden",display:"none"})})}}),$(function(){"use strict";new gb.ui.ContentManager("#content");$(window).resize(gb.util.throttle(gb.ui.onResizeHandler,500))});
//# sourceMappingURL=site.map.js